<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualiseur : Loi d'Ohm & Puissance</title>
    <!-- Chargement de Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Chargement de la police Inter --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* Custom scrollbar for a more modern look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; /* slate-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; /* slate-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* slate-500 */
        }
        /* Définition de la police Inter comme police par défaut */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style pour le canvas pour s'assurer qu'il s'affiche correctement */
        canvas {
            display: block;
            width: 100%;
            border-radius: 0.5rem; /* Coins arrondis */
        }
        /* Style pour les curseurs (sliders) */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background-color: #334155; /* bg-slate-700 */
            border-radius: 4px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background-color: #f59e0b; /* bg-yellow-500 */
            border-radius: 50%;
            cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background-color: #f59e0b; /* bg-yellow-500 */
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen p-4 md:p-8 flex items-center justify-center">

    <a href="../index.html" class="absolute top-4 left-4 z-50 inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-full transition-all duration-300 bg-slate-700 text-slate-300 hover:bg-slate-600 shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Retour
    </a>

    <div class="max-w-4xl w-full bg-slate-800 rounded-2xl shadow-2xl p-6 md:p-8 space-y-6">
        
        <!-- Titre --><h1 class="text-3xl font-bold text-center text-yellow-400">
            Visualiseur : Loi d'Ohm & Puissance
        </h1>
        
        <!-- Zone de Simulation --><div class="bg-slate-900 p-4 rounded-lg shadow-inner">
            <canvas id="wire-canvas" height="150"></canvas>
        </div>

        <!-- Panneau de Contrôle --><div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Contrôles des Sliders --><div class="bg-slate-700 p-5 rounded-lg space-y-6">
                <!-- Contrôle de la Tension -->
                <div>
                    <label for="voltage-slider" class="font-semibold text-lg">
                        Contrôler la Tension (Volts)
                    </label>
                    <div class="flex items-center space-x-4 mt-3">
                        <input id="voltage-slider" type="range" min="0" max="48" value="12" step="1" class="w-full">
                        <span id="voltage-value" class="text-xl font-bold text-purple-400 w-20 text-right">
                            12 V
                        </span>
                    </div>
                </div>

                <!-- Contrôle de la Résistance -->
                <div>
                    <label for="resistance-slider" class="font-semibold text-lg">
                        Contrôler la Résistance (Ohms)
                    </label>
                    <div class="flex items-center space-x-4 mt-3">
                        <input id="resistance-slider" type="range" min="1" max="100" value="10" step="1" class="w-full">
                        <span id="resistance-value" class="text-xl font-bold text-red-400 w-20 text-right">
                            10 Ω
                        </span>
                    </div>
                </div>
            </div>

            <!-- Boutons Pause et Réinitialisation --><div class="bg-slate-700 p-5 rounded-lg grid grid-cols-2 gap-4 items-center justify-center">
                <button id="pause-button" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 shadow-lg">
                    Pause
                </button>
                <button id="reset-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 shadow-lg">
                    Réinitialiser
                </button>
            </div>
        </div>

        <!-- Jauges de Visualisation --><div class="grid grid-cols-2 md:grid-cols-3 gap-6">
            <!-- Jauge 1: Tension --><div class="bg-slate-700 p-6 rounded-lg text-center shadow-lg">
                <h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">
                    Tension (Source)
                </h2>
                <div id="voltage-display" class="text-5xl font-extrabold text-purple-400">
                    12 V
                </div>
            </div>
            
            <!-- Jauge 2: Ampèremètre --><div class="bg-slate-700 p-6 rounded-lg text-center shadow-lg">
                <h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">
                    Courant (Actuel)
                </h2>
                <div id="current-display" class="text-5xl font-extrabold text-yellow-400">
                    1.2 A
                </div>
            </div>

            <!-- Jauge 3: Puissance (NOUVEAU) --><div class="bg-slate-700 p-6 rounded-lg text-center shadow-lg">
                <h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">
                    Puissance (Watts)
                </h2>
                <div id="power-display" class="text-5xl font-extrabold text-orange-400">
                    0.0 W
                </div>
            </div>

            <!-- Jauge 4: Compteur de Coulombs --><div class="bg-slate-700 p-6 rounded-lg text-center shadow-lg">
                <h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">
                    Charge Passée
                </h2>
                <div id="coulomb-display" class="text-5xl font-extrabold text-blue-400">
                    0.0 C
                </div>
            </div>
            
            <!-- Jauge 5: Énergie (NOUVEAU) --><div class="bg-slate-700 p-6 rounded-lg text-center shadow-lg">
                <h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">
                    Énergie Dépensée
                </h2>
                <div id="energy-display" class="text-5xl font-extrabold text-red-400">
                    0.0 J
                </div>
            </div>

            <!-- Jauge 6: Compteur de Temps --><div class="bg-slate-700 p-6 rounded-lg text-center shadow-lg">
                <h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">
                    Temps Écoulé
                </h2>
                <div id="time-display" class="text-5xl font-extrabold text-green-400">
                    0.0 s
                </div>
            </div>
        </div>
        
        <!-- Explication --><div class="text-center bg-slate-700 p-4 rounded-lg space-y-2">
            <p class="text-lg text-slate-300">
                <span class="font-bold text-yellow-400">Courant (A)</span> = <span class="font-bold text-purple-400">Tension (V)</span> / <span class="font-bold text-red-400">Résistance (Ω)</span>
            </p>
            <p class="text-lg text-slate-300">
                <span class="font-bold text-orange-400">Puissance (W)</span> = <span class="font-bold text-purple-400">Tension (V)</span> * <span class="font-bold text-yellow-400">Courant (A)</span>
            </p>
            <p class="text-md text-slate-400 mt-1">
                <span class="font-bold text-blue-400">Charge (C)</span> = <span class="font-bold text-yellow-400">Courant (A)</span> * <span class="font-bold text-green-400">Temps (s)</span>
            </p>
            <p class="text-md text-slate-400 mt-1">
                <span class="font-bold text-red-400">Énergie (J)</span> = <span class="font-bold text-orange-400">Puissance (W)</span> * <span class="font-bold text-green-400">Temps (s)</span>
            </p>
        </div>

    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            // Éléments du DOM
            const canvas = document.getElementById('wire-canvas');
            const ctx = canvas.getContext('2d');
            const resistanceSlider = document.getElementById('resistance-slider');
            const resistanceValueDisplay = document.getElementById('resistance-value');
            const voltageSlider = document.getElementById('voltage-slider');
            const voltageValueDisplay = document.getElementById('voltage-value');
            const currentDisplay = document.getElementById('current-display');
            const coulombDisplay = document.getElementById('coulomb-display');
            const pauseButton = document.getElementById('pause-button'); 
            const resetButton = document.getElementById('reset-button');
            const timeDisplay = document.getElementById('time-display');
            const voltageDisplay = document.getElementById('voltage-display');
            const powerDisplay = document.getElementById('power-display');
            const energyDisplay = document.getElementById('energy-display');

            // Paramètres de simulation
            let currentVoltage = parseFloat(voltageSlider.value); 
            let currentResistance = parseFloat(resistanceSlider.value); 
            let targetAmperes = 0; 
            let currentPower = 0;

            let totalCoulombs = 0;
            let totalTime = 0;
            let totalEnergy = 0;
            let lastTimestamp = 0;
            let isPaused = false; 
            
            let totalDisplacement = 0; 

            const particles = [];
            const particleCount = 200; 
            const wireHeight = 80; 

            function setupCanvas() {
                canvas.width = canvas.offsetWidth;
                canvas.height = 150; 
            }

            function initParticles() {
                particles.length = 0; 
                const wireY = (canvas.height - wireHeight) / 2;
                const startX = 45;

                for (let i = 0; i < particleCount; i++) {
                    particles.push({
                        baseX: startX + Math.random() * (canvas.width - startX),
                        x: 0,
                        y: wireY + wireHeight / 2 + (Math.random() - 0.5) * (wireHeight / 1.5),
                        radius: 1.5, 
                        color: 'rgba(255, 255, 255, 0.9)' 
                    });
                }
                totalDisplacement = 0;
                updateParticles();
            }

            function drawBattery() {
                const x = 15;
                const y = (canvas.height - wireHeight) / 2;
                const batteryWidth = 30;
                const batteryHeight = wireHeight;
                const capHeight = 10;
                const capWidth = 15;

                ctx.fillStyle = '#475569'; // slate-600
                ctx.fillRect(x, y, batteryWidth, batteryHeight);
                
                ctx.fillStyle = '#64748b'; // slate-500
                ctx.fillRect(x + (batteryWidth - capWidth) / 2, y - capHeight, capWidth, capHeight);

                ctx.fillStyle = '#e2e8f0'; // slate-200
                ctx.font = 'bold 16px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('+', x + batteryWidth / 2, y + batteryHeight * 0.25);
                
                ctx.font = 'bold 20px Inter';
                ctx.fillText('−', x + batteryWidth / 2, y + batteryHeight * 0.75);
            }

            function drawWire() {
                const wireY = (canvas.height - wireHeight) / 2;
                ctx.fillStyle = '#334155'; // bg-slate-700
                const startX = 45; 
                ctx.fillRect(startX, wireY, canvas.width - startX, wireHeight);
                ctx.fillRect(15, wireY + wireHeight - 5, 30, 5); 
                ctx.fillRect(15 + (30-15)/2, wireY - 10, 5, 10);
                ctx.fillRect(15 + (30-15)/2, wireY, 22 - (15-15)/2, 5);
            }

            function getHeatColor(power) {
                const maxVisualPower = 500;
                const heatRatio = Math.min(power / maxVisualPower, 1.0);
                const r = 220 + heatRatio * (255 - 220);
                const g = 38 + heatRatio * (255 - 38);
                const b = 38 + heatRatio * (150 - 38);
                return `rgb(${r.toFixed(0)}, ${g.toFixed(0)}, ${b.toFixed(0)})`;
            }

            function drawResistor(power) {
                const resistorWidth = 60;
                const resistorHeight = wireHeight * 0.8;
                const x = (canvas.width / 2) - (resistorWidth / 2);
                const y = (canvas.height / 2) - (resistorHeight / 2);
                const heatColor = getHeatColor(power);
                ctx.strokeStyle = heatColor;
                ctx.lineWidth = 4;
                ctx.strokeRect(x, y, resistorWidth, resistorHeight);
                ctx.fillStyle = heatColor;
                ctx.font = 'bold 16px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(currentResistance.toFixed(0) + ' Ω', x + resistorWidth / 2, y - 15);
            }

            function drawAmmeter() {
                const x = (canvas.width / 2) - 100;
                const wireY = (canvas.height - wireHeight) / 2;
                ctx.strokeStyle = '#f59e0b';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(x, wireY);
                ctx.lineTo(x, wireY + wireHeight);
                ctx.stroke();
                ctx.fillStyle = '#f59e0b';
                ctx.beginPath();
                ctx.arc(x, canvas.height / 2, 15, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#0f172a'; // bg-slate-900
                ctx.font = 'bold 18px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('A', x, canvas.height / 2 + 1);
            }

            function drawParticles() {
                particles.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                });
            }

            function updateParticles() {
                const startX = 45;
                const wireWidth = canvas.width - startX;
                particles.forEach(p => {
                    p.x = startX + ((p.baseX - startX + totalDisplacement) % wireWidth);
                });
            }

            function simulationLoop(timestamp) {
                if (isPaused) {
                    lastTimestamp = timestamp;
                    requestAnimationFrame(simulationLoop);
                    return; 
                }
                if (lastTimestamp === 0) {
                    lastTimestamp = timestamp;
                }
                const deltaTime = (timestamp - lastTimestamp) / 1000;
                lastTimestamp = timestamp;
                const visualSpeedPerSecond = targetAmperes * 30;
                totalDisplacement += visualSpeedPerSecond * deltaTime;
                if (targetAmperes > 0) {
                    const chargePassedThisFrame = targetAmperes * deltaTime;
                    totalCoulombs += chargePassedThisFrame;
                    const energyThisFrame = currentPower * deltaTime;
                    totalEnergy += energyThisFrame;
                    totalTime += deltaTime;
                }
                coulombDisplay.textContent = totalCoulombs.toFixed(2) + ' C';
                energyDisplay.textContent = totalEnergy.toFixed(1) + ' J';
                timeDisplay.textContent = totalTime.toFixed(1) + ' s';
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBattery();
                drawWire();
                drawResistor(currentPower);
                drawAmmeter();
                updateParticles();
                drawParticles();
                requestAnimationFrame(simulationLoop);
            }

            function updateCalculation() {
                currentVoltage = parseFloat(voltageSlider.value);
                currentResistance = parseFloat(resistanceSlider.value);
                targetAmperes = currentVoltage / currentResistance;
                currentPower = currentVoltage * targetAmperes;
                voltageValueDisplay.textContent = `${currentVoltage.toFixed(0)} V`;
                voltageDisplay.textContent = `${currentVoltage.toFixed(0)} V`;
                resistanceValueDisplay.textContent = `${currentResistance.toFixed(0)} Ω`;
                currentDisplay.textContent = `${targetAmperes.toFixed(1)} A`;
                powerDisplay.textContent = `${currentPower.toFixed(1)} W`;
            }

            resistanceSlider.addEventListener('input', updateCalculation);
            voltageSlider.addEventListener('input', updateCalculation);

            pauseButton.addEventListener('click', () => {
                isPaused = !isPaused;
                if (isPaused) {
                    pauseButton.textContent = 'Reprendre';
                    pauseButton.classList.remove('bg-yellow-600', 'hover:bg-yellow-700');
                    pauseButton.classList.add('bg-green-600', 'hover:bg-green-700');
                } else {
                    pauseButton.textContent = 'Pause';
                    pauseButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                    pauseButton.classList.add('bg-yellow-600', 'hover:bg-yellow-700');
                }
            });

            resetButton.addEventListener('click', () => {
                totalCoulombs = 0;
                totalTime = 0;
                totalEnergy = 0;
                coulombDisplay.textContent = '0.0 C';
                energyDisplay.textContent = '0.0 J';
                timeDisplay.textContent = '0.0 s';
                lastTimestamp = performance.now(); 
                totalDisplacement = 0;
                updateParticles();
                if (isPaused) {
                    isPaused = false;
                    pauseButton.textContent = 'Pause';
                    pauseButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                    pauseButton.classList.add('bg-yellow-600', 'hover:bg-yellow-700');
                }
            });

            window.addEventListener('resize', () => {
                setupCanvas();
                initParticles(); 
                updateParticles();
            });

            setupCanvas();
            initParticles();
            updateCalculation();
            requestAnimationFrame(simulationLoop);
        });
    </script>
</body>
</html>